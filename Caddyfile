# Caddy configuration for reverse proxy and static file serving

# This block handles requests coming from the Tor hidden service (internal port 80)
# It reverse proxies to the target website.
:80 {
    # Reverse proxy to the specified website
    reverse_proxy https://censorshipbypassguide.vercel.app {
        # Pass original Host header to the backend
        header_up Host {http.request.host} # Explicitly preserve the Host header
        header_up X-Real-IP {http.request.remote.host}
    }
}

# This block handles requests for the keep-alive HTML page (MkDocs site or static HTML)
# It will listen on the port provided by Render's environment variable (e.g., 8080).
# Render handles public HTTPS termination, so Caddy should listen on HTTP internally.
{$PORT} { # Using {$PORT} without a colon for Render compatibility
    tls off
    # Serve files from the 'site' directory generated by MkDocs (if applicable)
    # or the default HTML directory if you're not using MkDocs
    root * /app/source/site # Adjust this path if you revert to simple HTML (/usr/share/caddy/html)
    file_server
}
